{
  "project": "old-salt-blog-expansion",
  "description": "Expand the Old Salt Blog with 5 new features: full-text search, improved pagination/archives, newsletter signup placeholder, TinaCMS admin panel, and comments with WordPress comment migration.",
  "context": {
    "currentState": {
      "framework": "Astro 5.17.1",
      "posts": 6814,
      "contentPath": "src/content/blog/",
      "pagesPath": "src/pages/",
      "componentsPath": "src/components/",
      "existingFeatures": ["pagination (15/page)", "RSS feed", "category/tag archives", "responsive layout"]
    },
    "wpBaseUrl": "https://oldsaltblog.com",
    "apiEndpoints": {
      "comments": "/wp-json/wp/v2/comments?post={postId}&per_page=100"
    },
    "designSystem": {
      "accentColor": "#1e5a8e",
      "accentDark": "#0d3d5c",
      "fontFamily": "Atkinson"
    },
    "requirements": {
      "search": "Pagefind - static search index built at compile time",
      "newsletter": "Placeholder stub for future email integration",
      "admin": "TinaCMS - git-backed visual Markdown editor",
      "comments": "Giscus (GitHub Discussions) with legacy WP comments displayed as static"
    }
  },
  "tasks": [
    {
      "id": 14,
      "area": "newsletter",
      "title": "Create newsletter signup placeholder",
      "description": "Create a disabled newsletter signup form as a placeholder for future email integration. Add to footer. Include RSS link as current alternative.",
      "acceptance": [
        "src/components/NewsletterSignup.astro exists with disabled form",
        "Footer.astro includes NewsletterSignup component",
        "Form shows 'Coming Soon' message",
        "RSS link provided as alternative",
        "Styled to match site design"
      ],
      "passes": true
    },
    {
      "id": 15,
      "area": "pagination",
      "title": "Create year archive pages",
      "description": "Create archive pages that list posts by year. Include archive index showing all years with post counts, and individual year pages with paginated posts.",
      "acceptance": [
        "src/pages/archive/index.astro shows all years with post counts",
        "src/pages/archive/[year].astro shows posts for that year",
        "Year pages are paginated (15 posts/page)",
        "Years sorted newest first",
        "Header.astro includes 'Archive' navigation link"
      ],
      "passes": true
    },
    {
      "id": 16,
      "area": "pagination",
      "title": "Create improved pagination component",
      "description": "Create a reusable Pagination component with page number selector, first/last links, and optional page jump input. Replace existing inline pagination.",
      "acceptance": [
        "src/components/Pagination.astro created with props: currentPage, totalPages, baseUrl",
        "Shows: First | ... | 3 | 4 | [5] | 6 | 7 | ... | Last pattern",
        "Current page highlighted",
        "Mobile-friendly (simplified on small screens)",
        "Applied to index.astro, page/[page].astro, archive pages"
      ],
      "passes": true
    },
    {
      "id": 17,
      "area": "search",
      "title": "Integrate Pagefind search",
      "description": "Add Pagefind for full-text search across all posts. Install package, update build script, create search UI component, add to header.",
      "acceptance": [
        "@pagefind/default-ui installed",
        "package.json build script: 'astro build && npx pagefind --site dist'",
        "src/components/Search.astro with Pagefind UI integration",
        "Header.astro has search button that opens search modal/dropdown",
        "src/pages/[slug].astro has data-pagefind-body attribute",
        "pagefind.yml excludes nav, footer, pagination from index",
        "Search works after running npm run build && npm run preview"
      ],
      "passes": true
    },
    {
      "id": 18,
      "area": "comments",
      "title": "Create WordPress comment migration script",
      "description": "Fetch all comments from WordPress REST API and store as JSON files. Comments will be displayed as static content above Giscus.",
      "acceptance": [
        "scripts/migrate/comments.ts fetches comments from /wp-json/wp/v2/comments",
        "Handles pagination for posts with many comments",
        "Stores comments in src/data/comments/{slug}.json",
        "Each comment includes: author, date, content, parent (for threading)",
        "npm script 'migrate:comments' runs the migration",
        "Migration completes without errors"
      ],
      "passes": true
    },
    {
      "id": 19,
      "area": "comments",
      "title": "Create comments components",
      "description": "Create components to display legacy WordPress comments (static) and Giscus widget for new comments. Legacy comments shown above Giscus.",
      "acceptance": [
        "src/components/LegacyComments.astro displays static WP comments from JSON",
        "Comments show author, date, content with proper threading",
        "src/components/Comments.astro wraps LegacyComments + Giscus",
        "Giscus script configured (repo, category placeholders for user to fill)",
        "src/pages/[slug].astro includes Comments component",
        "Comments section styled to match site design"
      ],
      "passes": true
    },
    {
      "id": 20,
      "area": "admin",
      "title": "Set up TinaCMS",
      "description": "Initialize TinaCMS with configuration matching the existing content collection schema. Enable visual editing of blog posts.",
      "acceptance": [
        "npx @tinacms/cli@latest init run successfully",
        "tina/config.ts defines blog collection matching src/content.config.ts schema",
        "Fields: title, date, slug, excerpt, author, description, featuredImage, categories, tags, body",
        "package.json dev script: 'tinacms dev -c \"astro dev\"'",
        "package.json build script updated to include tinacms build",
        "Admin UI accessible at /admin after npm run dev",
        ".env.example documents TINA_CLIENT_ID, TINA_TOKEN for production"
      ],
      "passes": true
    },
    {
      "id": 21,
      "area": "verify",
      "title": "Verify all features work",
      "description": "Run the site and verify all new features work correctly. Search returns results, archives work, comments display, TinaCMS admin loads.",
      "acceptance": [
        "npm run dev starts without errors",
        "Search: Build site, run preview, search finds posts",
        "Archives: /archive shows years, /archive/2020 shows posts",
        "Pagination: Page numbers work, can jump to specific pages",
        "Newsletter: Placeholder visible in footer",
        "Comments: Legacy comments display on posts (after migration)",
        "TinaCMS: /admin loads and shows post editor",
        "All styling consistent with existing design"
      ],
      "passes": true
    },
    {
      "id": 22,
      "area": "sync",
      "title": "Create build-time backfill script for new posts",
      "description": "Create a backfill script that runs automatically during every build to fetch any new posts from the main WordPress site (oldsaltblog.com) that don't exist locally. This ensures the Astro site stays in sync with new content published on WordPress.",
      "acceptance": [
        "scripts/migrate/backfill.ts created to check for and fetch new WordPress posts",
        "Script compares local slugs against WordPress API to identify missing posts",
        "New posts are converted and written to src/content/blog/ using existing converter/writer",
        "Script fetches comments for new posts and stores in src/data/comments/",
        "npm script 'backfill' added to run the script standalone",
        "package.json build script updated to run backfill before astro build",
        "Script logs which new posts were added (or 'No new posts found' if none)",
        "Script handles rate limiting and errors gracefully",
        "Build completes successfully with backfill integrated"
      ],
      "passes": true
    },
    {
      "id": 23,
      "area": "media",
      "title": "Migrate WordPress media to S3",
      "description": "Create a script to migrate all images and videos hosted on WordPress to an S3 bucket. For each media file: download locally, upload to S3, update references in markdown content to point to S3 URL, then delete the local file.",
      "acceptance": [
        "scripts/migrate/media-to-s3.ts created to handle media migration",
        "Script scans all markdown files in src/content/blog/ for WordPress media URLs (oldsaltblog.com/wp-content/uploads/)",
        "Script downloads each unique media file (images, videos) to a temp directory",
        "Script uploads files to configured S3 bucket with appropriate content-type headers",
        "Script updates all references in markdown files to use S3 URLs",
        "Script deletes local temp files after successful S3 upload",
        "S3 bucket name and credentials configurable via environment variables (AWS_S3_BUCKET, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION)",
        ".env.example updated with S3 configuration variables",
        "npm script 'migrate:media-s3' added to run the migration",
        "Script logs progress: files found, uploaded, and any errors",
        "Script handles duplicate URLs (same file referenced multiple times) efficiently",
        "Script preserves original file paths/names in S3 for organized storage"
      ],
      "passes": false
    }
  ]
}
